<% include header %>
<div class="ui grid" style="height: 100%;">
    <div class="two wide column" style="height: 100%; background-color: #1b1c1d;">
        <% include navbar %>
    </div>
    <div class="thirteen wide centered column" style="margin-top: 30px;">
        <div onsubmit="return" class="ui form">
            <div class="field">
                <label>åç§°</label>
                <input type="text" name="name" placeholder="åç§°" value="<%= video.name %>">
            </div>
            <div class="three fields">
                <div class="field">
                    <label>å›½å®¶</label>
                    <select class="ui search fluid dropdown" name="country">
                        <option value="">å›½å®¶</option>
                        <option value="ä¸­å›½">ğŸ‡¨ğŸ‡³ä¸­å›½</option>
                        <option value="ç¾å›½">ğŸ‡ºğŸ‡¸ç¾å›½</option>
                        <option value="è‹±å›½">ğŸ‡¬ğŸ‡§è‹±å›½</option>
                        <option value="æ³•å›½">ğŸ‡«ğŸ‡·æ³•å›½</option>
                        <option value="æ—¥æœ¬">ğŸ‡¯ğŸ‡µæ—¥æœ¬</option>
                        <option value="æ³°å›½">ğŸ‡¹ğŸ‡­æ³°å›½</option>
                        <option value="éŸ©å›½">ğŸ‡°ğŸ‡·éŸ©å›½</option>
                        <option value="å°åº¦">ğŸ‡®ğŸ‡³å°åº¦</option>
                        <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                        <option selected value="<%= video.country %>"><%= video.country %></option>
                    </select>
                </div>
                <div class="field">
                    <label>åˆ†ç±»</label>
                    <select class="ui search fluid dropdown" name="classify">
                        <option value="">åˆ†ç±»</option>
                        <option value="ç”µå½±">ç”µå½±</option>
                        <option value="ç”µè§†å‰§">ç”µè§†å‰§</option>
                        <option value="ç»¼è‰º">ç»¼è‰º</option>
                        <option value="åŠ¨æ¼«">åŠ¨æ¼«</option>
                        <option value="çºªå½•ç‰‡">çºªå½•ç‰‡</option>
                        <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                        <option selected value="<%= video.classify %>"><%= video.classify %></option>
                    </select>
                </div>
                <div class="field">
                    <label>ä¸Šæ˜ æ—¶é—´</label>
                    <input type="date" name="release_time" placeholder="ä¸Šæ˜ æ—¶é—´" value="<%= video.release_time %>">
                </div>
            </div>
            <div class="field">
                <label>å›¾ç‰‡</label>
                <input type="hidden" name="image" value="<%= video.image %>">
                <input type="file" name="newFile" multiple>
            </div>
            <div class="three fields">
                <div class="field">
                    <label>è¯„åˆ†</label>
                    <select class="ui search fluid dropdown" name="star">
                        <option value="">è¯„åˆ†</option>
                        <option value="10.0">10.0</option>
                        <option value="9.0">9.0</option>
                        <option value="8.0">8.0</option>
                        <option value="7.0">7.0</option>
                        <option value="6.0">6.0</option>
                        <option value="5.0">5.0</option>
                        <option value="4.0">4.0</option>
                        <option value="3.0">3.0</option>
                        <option value="2.0">2.0</option>
                        <option value="1.0">1.0</option>
                        <option selected value="<%= video.star %>"><%= video.star %></option>
                    </select>
                </div>
                <div class="field">
                    <label>æ—¶é•¿</label>
                    <input type="text" name="duration" placeholder="æ—¶é•¿" value="<%= video.duration %>">
                </div>
                <div class="field">
                    <label>ç±»å‹</label>
                    <select class="ui search fluid dropdown" name="type">
                        <option value="">ç±»å‹</option>
                        <option value="åŠ¨ä½œ">åŠ¨ä½œ</option>
                        <option value="å–œå‰§">å–œå‰§</option>
                        <option value="çˆ±æƒ…">çˆ±æƒ…</option>
                        <option value="å‰§æƒ…">å‰§æƒ…</option>
                        <option value="å¤è£…">å¤è£…</option>
                        <option value="å†å²">å†å²</option>
                        <option value="æˆ˜äº‰">æˆ˜äº‰</option>
                        <option value="ç§‘å¹»">ç§‘å¹»</option>
                        <option value="æƒŠæ‚š">æƒŠæ‚š</option>
                        <option value="ææ€–">ææ€–</option>
                        <option value="å†’é™©">å†’é™©</option>
                        <option value="çºªå½•ç‰‡">çºªå½•ç‰‡</option>
                        <option value="æ­¦ä¾ ">æ­¦ä¾ </option>
                        <option value="åŠ¨ç”»">åŠ¨ç”»</option>
                        <option value="çŠ¯ç½ª">çŠ¯ç½ª</option>
                        <option value="è„±å£ç§€">è„±å£ç§€</option>
                        <option value="æˆäºº">æˆäºº</option>
                        <option value="å„¿ç«¥">å„¿ç«¥</option>
                        <option selected value="<%= video.type %>"><%= video.type %></option>
                    </select>
                </div>
            </div>
            <div class="field">
                <label>å¯¼æ¼”/æ¼”å‘˜</label>
                <input type="text" name="actors" placeholder="å¯¼æ¼”/æ¼”å‘˜" value="<%= video.actors %>">
            </div>
            <div class="field">
                <label>æè¿°</label>
                <textarea name="detail" placeholder="å¯¼æ¼”/æ¼”å‘˜"><%= video.detail %></textarea>
            </div>
            <div class="ui button submit">Submit</div>
        </div>
    </div>
</div>

<script>
  $(function () {
    $('select.dropdown').dropdown()
    let formdata = new FormData()
    formdata.append('image', $('input[name=image]').val())
    $('input[name=newFile]').change(function (e) {
      console.log(e.target)
      formdata.append('newFile', e.target.files[0])
    })
    let isAllow = true
    if (!isAllow) return
    $('.ui.form')
      .form({
        inline: true,
        on: 'blur',
        onSuccess: function () {
          isAllow = false
          let inputArr = Array.of('name', 'release_time', 'duration', 'actors')
          if (inputArr) {
            inputArr.forEach(function (val) {
              formdata.append(val, $('input[name=' + val + ']').val())
            })
          }
          let selectArr = Array.of('country', 'classify', 'star', 'type')
          if (selectArr) {
            selectArr.forEach(function (val) {
              formdata.append(val, $('select[name=' + val + ']').val())
            })
          }
          formdata.append('detail', $('textarea').val())
          $.ajax({
            url: location.pathname,
            type: 'POST',
            cache: false,
            data: formdata,
            processData: false,
            contentType: false,
            dataType: 'json',
            success: function (data) {
              isAllow = true
              if (data.code === 200) {
                alert('ä¿®æ”¹æˆåŠŸ')
                location.href = '/'
                formdata = new FormData()
              } else {
                alert('ä¿®æ”¹å¤±è´¥')
                formdata = new FormData()
              }
            }
          })
        },
        fields: {
          name: {
            identifier: 'name',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥åç§°ï¼'
              }
            ]
          },
          country: {
            identifier: 'country',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥å›½å®¶ï¼'
              }
            ]
          },
          classify: {
            identifier: 'classify',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥åˆ†ç±»ï¼'
              }
            ]
          },
          release_time: {
            identifier: 'release_time',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥æ—¶é—´ï¼'
              }
            ]
          },
          image: {
            identifier: 'image',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·ä¸Šä¼ å›¾ç‰‡ï¼'
              }
            ]
          },
          star: {
            identifier: 'star',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥è¯„åˆ†ï¼'
              }
            ]
          },
          duration: {
            identifier: 'duration',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥æ—¶é•¿ï¼'
              }
            ]
          },
          type: {
            identifier: 'type',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥ç±»å‹ï¼'
              }
            ]
          },
          actors: {
            identifier: 'actors',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥å¯¼æ¼”å’Œæ¼”å‘˜ï¼'
              }
            ]
          },
          detail: {
            identifier: 'detail',
            rules: [
              {
                type: 'empty',
                prompt: 'è¯·è¾“å…¥æè¿°ï¼'
              }
            ]
          },
        }
      })
  })
</script>
<% include footer %>